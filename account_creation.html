<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CFO - Create User</title>

<style>
body{
    font-family: Arial;
    background:#eef2f7;
    padding:40px;
}

.container{
    max-width:600px;
    margin:auto;
    background:white;
    padding:25px;
    border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

h2{
    text-align:center;
}

input, select{
    width:100%;
    padding:8px;
    margin:10px 0;
}

button{
    padding:8px 14px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    background:#4a90e2;
    color:white;
}

.top-bar{
    text-align:right;
    margin-bottom:10px;
}
</style>
</head>

<body>

<div class="container">

<div class="top-bar">
    <button onclick="logout()">Logout</button>
</div>

<h2>Create New User</h2>

<label>Name</label>
<input type="text" id="name">

<label>Email</label>
<input type="email" id="email">

<label>Role</label>
<select id="role">
    <option value="employee">Employee</option>
    <option value="manager">Manager</option>
</select>

<button onclick="createUser()">Create User</button>

</div>

<script>

/* üîê Protect Page (CFO only) */
if(localStorage.getItem("role") !== "cfo"){
    window.location.href = "index.html";
}

/* üöÄ Create User */
async function createUser(){

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const role = document.getElementById("role").value;

    if(!name || !email){
        alert("Please fill all fields");
        return;
    }

    try{

        const response = await fetch(
            "https://expense-backend-a2t0.onrender.com/api/auth/create-user",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + localStorage.getItem("token")
                },
                body: JSON.stringify({ name, email, role })
            }
        );

        const data = await response.json();

        if(!response.ok){
            alert(data.message);
            return;
        }

        alert("User created successfully! Password sent to email.");

        document.getElementById("name").value="";
        document.getElementById("email").value="";

    } catch(error){
        console.error(error);
        alert("Server error. Check console.");
    }
}

/* üö™ Logout */
function logout(){
    localStorage.removeItem("token");
    localStorage.removeItem("role");
    window.location.href = "index.html";
}

</script>

</body>
</html>
