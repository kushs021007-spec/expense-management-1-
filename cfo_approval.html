<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CFO Pending Approvals</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#eef2f7;
    padding:40px;
}

.container{
    max-width:900px;
    margin:auto;
    background:white;
    padding:25px;
    border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

h2{
    text-align:center;
    color:#2c3e50;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}

th, td{
    border:1px solid #ddd;
    padding:10px;
    text-align:center;
}

th{
    background:#4a90e2;
    color:white;
}

button{
    padding:7px 12px;
    margin:4px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    color:white;
}

.approve{ background:green; }
.reject{ background:red; }
.nav-btn{
    background:#4a90e2;
}

.bottom-buttons{
    margin-top:20px;
    text-align:center;
}
</style>
</head>

<body>

<div class="container">

<h2>CFO Pending Approvals</h2>

<table>
<thead>
<tr>
    <th>Employee</th>
    <th>Amount</th>
    <th>Status</th>
    <th>Action</th>
</tr>
</thead>

<tbody id="approvalTable"></tbody>
</table>

<div class="bottom-buttons">
    <button class="nav-btn" onclick="goBack()">â¬… Back to Account Creation</button>
    <button class="nav-btn" onclick="openAnalysis()">ðŸ“Š View Analysis</button>
</div>

</div>

<script>

// Bills stored from manager stage
let bills = JSON.parse(localStorage.getItem("bills")) || [];

// Load bills waiting for CFO
function loadBills(){

    const table = document.getElementById("approvalTable");
    table.innerHTML = "";

    bills
    .filter(b => b.status === "manager_approved")
    .forEach((bill,index)=>{

        let row = table.insertRow();

        row.insertCell(0).innerText = bill.user;
        row.insertCell(1).innerText = bill.amount;
        row.insertCell(2).innerText = "Waiting CFO Approval";

        row.insertCell(3).innerHTML = `
            <button class="approve" onclick="approve(${index})">
                Approve
            </button>
            <button class="reject" onclick="reject(${index})">
                Reject
            </button>
        `;
    });
}


// CFO Approves
function approve(i){
    bills[i].status = "approved";
    updateAnalysis("approved");
    saveBills();
}


// CFO Rejects
function reject(i){
    bills[i].status = "rejected";
    updateAnalysis("rejected");
    saveBills();
}


// Save bills
function saveBills(){
    localStorage.setItem("bills", JSON.stringify(bills));
    loadBills();
}


// Update analytics data
function updateAnalysis(type){

    let stats =
    JSON.parse(localStorage.getItem("analysis")) || {
        approved:0,
        rejected:0,
        bothApproved:0
    };

    if(type === "approved"){
        stats.approved++;
        stats.bothApproved++;
    }else{
        stats.rejected++;
    }

    localStorage.setItem("analysis", JSON.stringify(stats));
}


// Navigation buttons
function goBack(){
    window.location.href = "account_creation.html";
}

function openAnalysis(){
    window.location.href = "analysis.html";
}


// Initial load
loadBills();

</script>

</body>
</html>
